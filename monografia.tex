% ------------------------------------------------------------------------
% ------------------------------------------------------------------------
% Monografia Peacon
% Trabalho de Conclusão de Curso
% Baseia-se no documento modelo de TCC do abntex2
% Para saber mais, acesse https://github.com/abntex/abntex2
% ------------------------------------------------------------------------
% ------------------------------------------------------------------------

\documentclass[
		% -- opções da classe memoir --
		12pt,				% tamanho da fonte
		openright,			% capítulos começam em pág ímpar (insere página vazia caso preciso)
		oneside,			% para impressão em verso e anverso. Oposto a oneside
		a4paper,			% tamanho do papel. 
		% -- opções da classe abntex2 --
		chapter=TITLE,		% títulos de capítulos convertidos em letras maiúsculas
		%section=TITLE,		% títulos de seções convertidos em letras maiúsculas
		%subsection=TITLE,	% títulos de subseções convertidos em letras maiúsculas
		%subsubsection=TITLE,% títulos de subsubseções convertidos em letras maiúsculas
		% -- opções do pacote babel --
		english,			% idioma adicional para hifenização
		brazil				% o último idioma é o principal do documento
	]{abntex2}


% ----------------------------------------------------------
% Pacotes básicos 
% ----------------------------------------------------------
%\usepackage{helvet}			
\usepackage[scaled]{helvet}
\renewcommand*\familydefault{\sfdefault} 	% Only if the base font of the document is to be sans serif
										% Foi necessário para acertar o documento, continha diversos erros
\usepackage[T1]{fontenc}		% Selecao de codigos de fonte.
\usepackage[utf8]{inputenc}	% Codificacao do documento (conversão automática dos acentos)
\usepackage{lastpage}		% Usado pela Ficha catalográfica
\usepackage{indentfirst}		% Indenta o primeiro parágrafo de cada seção.
\usepackage{color}			% Controle das cores
\usepackage{graphicx}		% Inclusão de gráficos
\usepackage{microtype} 		% para melhorias de justificação
% ----------------------------------------------------------
		

% ----------------------------------------------------------
% Pacotes adicionais, usados apenas no âmbito do Modelo Canônico do abnteX2
%% ----------------------------------------------------------
\usepackage{lipsum}				% para geração de dummy text
\usepackage{customizacoes} 		% customizações feitas pelo autor
% ----------------------------------------------------------


% ----------------------------------------------------------
% Pacotes de citações
% ----------------------------------------------------------
\usepackage[alf]{abntex2cite}				% Citações padrão ABNT

% ----------------------------------------------------------
% CONFIGURAÇÕES DE PACOTES
% ----------------------------------------------------------

% ----------------------------------------------------------
% Configurações do pacote backref
% ----------------------------------------------------------
\definecolor{thered}{rgb}{0.65,0.04,0.07}
\definecolor{thegreen}{rgb}{0.06,0.44,0.08}
\definecolor{thegrey}{gray}{0.5}
\definecolor{theshade}{rgb}{1,1,0.97}
\definecolor{theframe}{gray}{0.6}
% ----------------------------------------------------------


% ----------------------------------------------------------
% Informações de dados para CAPA e FOLHA DE ROSTO
% ----------------------------------------------------------

\titulo{Desenvolvimento de um Protótipo de Rastreador de Beacons utilizando o Raspberry Pi}
\autor{Gabriel Luiz Bastos Oliveira}
\local{Bauru}
\data{2015}
\orientador{Prof. Dr. Eduardo Martins Morgado}
\instituicao{%
  Universidade Estadual Paulista "Júlio de Mesquita Filho"
  \par
  Faculdade de Ciências - Campus Bauru
  \par
  Departamento de Computação
}
\tipotrabalho{Monografia (Trabalho de Conclusão de Curso)}
% O preambulo deve conter o tipo do trabalho, o objetivo, 
% o nome da instituição e a área de concentração 
% foi necessário utilizar \~{a} e etc para os acentos por problemas na geração do PDF
\preambulo{Trabalho de Conclus\~{a}o de Curso apresentado ao Departamento de Computa\c{c}\~{a}o da Faculdade de Ci\^{e}ncias da Universidade Estadual Paulista “J\'{ú}lio de Mesquita Filho” – UNESP, C\^{a}mpus de Bauru.}

% ----------------------------------------------------------


% ----------------------------------------------------------
% Configurações de aparência do PDF final
% ----------------------------------------------------------

% alterando o aspecto da cor azul
\definecolor{blue}{RGB}{0,0,0}

% informações do PDF
\makeatletter
\hypersetup{
     	%pagebackref=true,
		pdftitle={\@title}, 
		pdfauthor={\@author},
    	pdfsubject={\imprimirpreambulo},
	    pdfcreator={LaTeX with abnTeX2},
		pdfkeywords={beacon}{raspberry pi}{internet das coisas}{abntex2}{trabalho acadêmico}, 
		colorlinks=true,       		% false: boxed links; true: colored links
    	linkcolor=blue,          	% color of internal links
    	citecolor=blue,        		% color of links to bibliography
    	filecolor=magenta,      		% color of file links
		urlcolor=blue,
		bookmarksdepth=4
}
\makeatother
% ----------------------------------------------------------


% ----------------------------------------------------------
% Espaçamentos entre linhas e parágrafos 
% ----------------------------------------------------------

% O tamanho do parágrafo é dado por:
\setlength{\parindent}{1.3cm}

% Controle do espaçamento entre um parágrafo e outro:
\setlength{\parskip}{0.2cm}  % tente também \onelineskip

% ----------------------------------------------------------
% compila o indice
% ----------------------------------------------------------
\makeindex
% ----------------------------------------------------------


% ----------------------------------------------------------
% Configurações de projeto
% ----------------------------------------------------------
\newif\iffinal
\finaltrue % define se é um arquivo final, se for não for retira umas partes. 

\newif\ifrelatorio
\relatoriofalse % define se é um arquivo final, se for não for retira umas partes. 

\newif\ifabstract
\abstractfalse % define se mostra o abstract em inglês ou não.

\newif\ifresumo
\resumotrue % define se mostra o resumo ou não.

\newif\ifficha
\fichafalse % define se mostra a ficha catalográfica ou não
% ----------------------------------------------------------


% ----------------------------------------------------------
% Início do documento
% ----------------------------------------------------------
\begin{document}

% Seleciona o idioma do documento (conforme pacotes do babel)
%\selectlanguage{english}
\selectlanguage{brazil}

% Retira espaço extra obsoleto entre as frases.
\frenchspacing 

% ----------------------------------------------------------
% ELEMENTOS PRÉ-TEXTUAIS
% ----------------------------------------------------------
\pretextual


% ----------------------------------------------------------
% Capa
% ----------------------------------------------------------
\imprimircapa
% ----------------------------------------------------------


% ----------------------------------------------------------
% Folha de rosto
% (o * indica que haverá a ficha bibliográfica)
% ----------------------------------------------------------
\imprimirfolhaderosto
% ----------------------------------------------------------


% ----------------------------------------------------------
% Inserir a ficha catalográfica
% ----------------------------------------------------------

% Isto é um exemplo de Ficha Catalográfica, ou "Dados internacionais de
% catalogação-na-publicação''. Você pode utilizar este modelo como referência. 
% Porém, provavelmente a biblioteca da sua universidade lhe fornecerá um PDF
% com a ficha catalográfica definitiva após a defesa do trabalho. Quando estiver
% com o documento, salve-o como PDF no diretório do seu projeto e substitua todo
% o conteúdo de implementação deste arquivo pelo comando abaixo:
%
% \begin{fichacatalografica}
%     \includepdf{fig_ficha_catalografica.pdf}
% \end{fichacatalografica}

\ifficha
  \begin{fichacatalografica}
	\sffamily
	\vspace*{\fill}					% Posição vertical
	\begin{center}					% Minipage Centralizado
	\fbox{\begin{minipage}[c][8cm]{13.5cm}		% Largura
	\small
	\imprimirautor
	%Sobrenome, Nome do autor
	
	\hspace{0.5cm} \imprimirtitulo  / \imprimirautor. --
	\imprimirlocal, \imprimirdata-
	
	\hspace{0.5cm} \pageref{LastPage} p. : il. (algumas color.) ; 30 cm.\\
	
	\hspace{0.5cm} \imprimirorientadorRotulo~\imprimirorientador\\
	
	\hspace{0.5cm}
	\parbox[t]{\textwidth}{\imprimirtipotrabalho~--~\\ \imprimirinstituicao,
	\imprimirdata.}\\
	
	\hspace{0.5cm}
		1. Beacon.
		2. Raspberry Pi.
		3. Internet das Coisas.
		I. \imprimirorientador.
		II. Universidade Estadual Paulista "Júlio de Mesquita Filho".
		III. Faculdade de Ciências.
		IV. Título
	\end{minipage}}
	\end{center}
  \end{fichacatalografica}
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% Inserir errata
% ----------------------------------------------------------
%\begin{errata}
%Elemento opcional da \citeonline[4.2.1.2]{NBR14724:2011}. Exemplo:

%\vspace{\onelineskip}

%FERRIGNO, C. R. A. \textbf{Tratamento de neoplasias ósseas apendiculares com
%reimplantação de enxerto ósseo autólogo autoclavado associado ao plasma
%rico em plaquetas}: estudo crítico na cirurgia de preservação de membro em
%cães. 2011. 128 f. Tese (Livre-Docência) - Faculdade de Medicina Veterinária e
%Zootecnia, Universidade de São Paulo, São Paulo, 2011.

%\begin{table}[htb]
%\center
%\footnotesize
%\begin{tabular}{|p{1.4cm}|p{1cm}|p{3cm}|p{3cm}|}
%  \hline
%   \textbf{Folha} & \textbf{Linha}  & \textbf{Onde se lê}  & \textbf{Leia-se}  \\
%    \hline
%    1 & 10 & auto-conclavo & autoconclavo\\
%   \hline
%\end{tabular}
%\end{table}

%\end{errata}
% ----------------------------------------------------------


% ----------------------------------------------------------
% Inserir folha de aprovação
% ----------------------------------------------------------

% Isto é um exemplo de Folha de aprovação, elemento obrigatório da NBR
% 14724/2011 (seção 4.2.1.3). Você pode utilizar este modelo até a aprovação
% do trabalho. Após isso, substitua todo o conteúdo deste arquivo por uma
% imagem da página assinada pela banca com o comando abaixo:
%
% \includepdf{folhadeaprovacao_final.pdf}
%
\begin{folhadeaprovacao}
	\begin{center}
		{\ImprimirAutor}
		
		\vspace*{\fill}\vspace*{\fill}
		\begin{center}
			\bfseries\large\ImprimirTitulo
		\end{center}
		\vspace*{\fill}
   
		\hspace{.45\textwidth}
		\begin{minipage}{.5\textwidth}
			\imprimirpreambulo
		\end{minipage}%
		\vspace*{\fill}
     
		%Trabalho aprovado. \imprimirlocal, 24 de novembro de 2012:
   
		\uppercase{Banca examinadora}
	\end{center}
	
	Aprovado em \detokenize{___/___/___}.

	\assinatura{\textbf{\imprimirorientador} \\ Orientador} 
	\assinatura{\textbf{Prof. Dr. Aparecido Nilceu Marana}}
	\assinatura{\textbf{Profa. Dra. Márcia A. Z. Meira e Silva}}
	%\assinatura{\textbf{Professor} \\ Convidado 3}
	%\assinatura{\textbf{Professor} \\ Convidado 4}
	
	\vspace*{0.5cm}
	\hspace{.5\textwidth}
	\begin{center} 
		{ \ImprimirLocal \\ \imprimirdata }
	\end{center}
\end{folhadeaprovacao}
% ----------------------------------------------------------


% ----------------------------------------------------------
% Dedicatória
% ----------------------------------------------------------
\ifrelatorio
	\begin{dedicatoria} 
		\vspace*{\fill}
		\centering
		\noindent
		\textit{ Este trabalho é dedicado às crianças adultas que,\\
				quando pequenas, sonharam em se tornar cientistas.} 
		\vspace*{\fill}
	\end{dedicatoria}
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% Agradecimentos
% ----------------------------------------------------------
\iffinal
	\begin{agradecimentos}

Agradeço ao meu orientador Prof. Dr. Eduardo Morgado, por todo o tempo e trajetória no LTIA\footnote{Laboratório de Tecnologia da Informação Aplicada}, pela confiança, apoio e incentivo. Agradeço também pelo auxílio em todas as etapas desse projeto, desde a definição do tema até a apresentação final.

A Henrique Lopes Santos, pela ajuda na realização das fotos e também criação do logotipo para o protótipo.

A Elisa Castro, pelo apoio na correção e melhorias na digitação do texto contido nesse documento.

A Giovanna Aguirre, pelo apoio, incentivo, paciência e companhia nos momentos mais importantes de minha vida.

A todos os colegas do laboratório, pela incrível parceria, trabalho em equipe e organização de projetos. Os quatro anos percorridos com eles foram essenciais para meu crescimento profissional e pessoal.

A todos os professores, pois com muito esforço diário passaram não somente as informações técnicas e práticas de cada disciplina, mas lições que servirão para toda vida.

A todos os colegas de curso, que de alguma forma auxiliaram a chegar ao último semestre da melhor maneira possível.

Aos meus amigos e familiares, pelo apoio e incentivo na escolha e decorrer do curso, com muita compreensão e encorajamento.

	\end{agradecimentos}
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% Epígrafe
% ----------------------------------------------------------
\iffinal
	\begin{epigrafe}
		\vspace*{\fill}
			\begin{flushright}
			%\textit{"Sonhos não morrem, apenas \\ 
			%	 adormecem na alma da gente."\\
			%(Francisco Cândido Xavier)}
			\textit{"Que eu não perca a vontade de ajudar as pessoas, \\
				mesmo sabendo que muitas delas são incapazes \\
				de ver, reconhecer e retribuir esta ajuda."\\
				(Francisco Cândido Xavier)}
		\end{flushright}
	\end{epigrafe}
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% RESUMOS
% ----------------------------------------------------------
\ifresumo
	% resumo em português
	\setlength{\absparsep}{18pt} % ajusta o espaçamento dos parágrafos do resumo
	\begin{resumo}

	 		FALTA ACERTAR!!!!!! Atualmente a área da internet das coisas tem recebido um foco enorme. Um dos motivos é devido a ser bem nova e também facilitar a integração das pessoas com o mundo real. Essa área tem motivado várias pessoas pela possibilidade de ter um produto concreto após pouco tempo de trabalho. Por conta disso, alguns dispositivos foram criados para auxiliar essas áreas, entre eles o \textit{Arduino} e \textit{Raspberry Pi}. Os \textit{beacons} também são uma criação nova, comunicando com outros dispositivos maiores como o \textit{RPi} para auxiliar a micro-localização dentro de um pequeno espaço, com um baixo custo. O seu foco de uso é pequeno, somente com leituras via \textit{smartphones}. Esse projeto tem como objetivo criar um rastreador de \textit{beacons} utilizando o \textit{Raspberry Pi} para expandir essa capacidade, não necessitando de um celular para que os \textit{beacons} possam ser encontrados.

 			\textbf{Palavras-chave}: \textit{Beacon}. Raspberry Pi. Internet das Coisas.
 			
	\end{resumo}
	
	% resumo em inglês
	\begin{resumo}[Abstract]
	 	\begin{otherlanguage*}{english}
			This is the english abstract.

			\textbf{Keywords}: Beacon. Raspberry Pi. Internet of Things.
		\end{otherlanguage*}
	\end{resumo}
	
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% inserir lista de ilustrações
% ----------------------------------------------------------
\iffinal
	\pdfbookmark[0]{\listfigurename}{lof}
	\listoffigures*
	\cleardoublepage
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% inserir lista de tabelas
% ----------------------------------------------------------
\iffinal
	\pdfbookmark[0]{\listtablename}{lot}
	\listoftables*
	\cleardoublepage
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% inserir lista de abreviaturas e siglas
% ----------------------------------------------------------
\iffinal
	\begin{siglas}
			\item[BLE] \textit{Bluetooth Low Energy}
			\item[DIY] \textit{Do It Yourself} - Faça Você Mesmo
			\item[GPIO] \textit{General Input and Output}
			\item[IoT] \textit{Internet of Things} - Internet das Coisas
			\item[LTIA] Laboratório de Tecnologia da Informação Aplicada
			\item[RPi] \textit{Raspberry Pi}
			\item[SGBD] Sistema Gerenciador de Banco de Dados
	\end{siglas}
\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% inserir lista de símbolos
% ----------------------------------------------------------
%\iffinal
%	\begin{simbolos}
%			\item[$ \Gamma $] Letra grega Gama
%			\item[$ \Lambda $] Lambda
%			\item[$ \zeta $] Letra grega minúscula zeta
%			\item[$ \in $] Pertence
%	\end{simbolos}
%\fi
% ----------------------------------------------------------


% ----------------------------------------------------------
% inserir o sumario
% ----------------------------------------------------------
\pdfbookmark[0]{\contentsname}{toc}
\tableofcontents*
\cleardoublepage
% ----------------------------------------------------------



% ----------------------------------------------------------------------------------------------------------------------------------



% ----------------------------------------------------------------------------------------------------------------------------------
% ELEMENTOS TEXTUAIS
% ----------------------------------------------------------------------------------------------------------------------------------
\textual


% ----------------------------------------------------------
% Introdução
% ----------------------------------------------------------

\include{introducao}

% ----------------------------------------------------------


% ----------------------------------------------------------
% Objetivos
% ----------------------------------------------------------

\include{objetivos}

% ----------------------------------------------------------


% ----------------------------------------------------------
% Fundamentação Teórica
% ----------------------------------------------------------

\include{fundamentacao}

% ----------------------------------------------------------


% ----------------------------------------------------------
% Materiais e Métodos
% ----------------------------------------------------------
\chapter{Metodologia}\label{cap:metodologia}
% ----------------------------------------------------------

% ----------------------------------------------------------
\section{Métodos e Etapas}\label{sec:metodos-etapas}
% ----------------------------------------------------------

O projeto foi dividido em três etapas para facilitar o desenvolvimento completo. A primeira etapa foi o levantamento bibliográfico relacionado ao tema, realizadas buscas relacionadas aos assuntos: \textit{Raspberry Pi}, comunicação via \textit{Bluetooth Low Energy}, \textit{beacons}. Concomitantemente foi realizado o estudo prático das tecnologias, levando em conta suas capacidades, limitações, e aplicações.

A segunda etapa foi planejar o projeto baseado na análise do levantamento bibliográfico, assim como a definição de sua estrutura. Essa etapa foi necessária para facilitar e agilizar a implementação e testes dos componentes nas próximas etapas, definindo assim um escopo inicial de funcionalidades que o sistema terá, assim como outras tarefas a serem realizadas. O processo está detalhado no \autoref{cap:desenvolvimento} - \nameref{cap:desenvolvimento}.

A terceira etapa foi a implementação e testes do protótipo. As funcionalidades foram divididas em módulos para facilitar os testes e detectar possíveis erros e \textit{bugs}.

Todo o projeto foi desenvolvido no espaço do LTIA\footnote{Laboratório de Tecnologia da Informação Aplicada - \url{http://www.ltia.fc.unesp.br/}}, da Universidade Estadual Paulista "Júlio de Mesquita Filho"\ - Campus Bauru.


% ----------------------------------------------------------
\section{Materiais Utilizados}\label{sec:materiais-utilizados}
% ----------------------------------------------------------

% ---
\subsection{Raspberry Pi e Acessórios}\label{sec:rpi-acessorios}
% ---

A versão do Raspberry Pi escolhida para o projeto foi a 2 Modelo B, por ter mais processamento e mais memória RAM (\autoref{fig:rpi2-utilizado}), conforme informado na \autoref{sec:raspberry-pi}.

É necessário o uso de um adaptador \textit{WiFi} para conexão a internet sem necessidade de cabo \textit{Ethernet} e também um adaptador Bluetooth 4.0 com suporte a \textit{BLE} para fazer a busca dos pacotes \textit{beacon}. Os modelos de adaptadores usados foram Orico BTA-406 (bluetooth) e EDUP N8508GS (\textit{WiFi}), conforme \autoref{fig:adaptadores}.

O sistema operacional executado no RPi foi instalado em um cartão microSD, com no mínimo 4 GB de espaço. O cartão utilizado nesse projeto foi um SanDisk Ultra Class 10 de 8 GB. 

O sistema utilizado foi o Raspbian Wheezy. Durante o desenvolvimento do projeto, a versão Raspbian Jessie foi lançada, com inúmeras melhorias, porém preferiu-se por permanecer na versão Wheezy para evitar possíveis incompatibilidades com os softwares utilizados.

\begin{figure}[htb]
	\caption{\label{fig:rpi2-utilizado}\textit{RPi} 2 modelo B utilizado nesse projeto.}
	\begin{center}
		\includegraphics[width=0.7\textwidth]{img/rpi2.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

\begin{figure}[htb]
	\caption{\label{fig:adaptadores}Orico BTA-406 a esquerda e EDUP N8508GS a direita.}
	\begin{center}
		\includegraphics[width=0.5\textwidth]{img/adaptadores.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Na \autoref{sec:tecnologias-ferramentas} - \nameref{sec:tecnologias-ferramentas}, \autoref{sec:rpi-tecnologia} - \nameref{sec:rpi-tecnologia} aborda-se como o \textit{RPi} funciona na prática, como foi utilizado para esse projeto e como suas capacidades foram aproveitadas.

% ---
\subsection{Computadores e Softwares}\label{sec:comp-softwares}
% ---

A conexão com o \textit{RPi} foi realizada utilizando \textit{SSH}\footnote{\textit{Secure Shell}}, sem necessidade de monitor e teclado. O computador utilizado no projeto foi um MacBook Pro com sistema Mac OS X 10.10, posteriormente atualizado para 10.11. 

Nesse sistema o uso de \textit{SSH} é simples, basta abrir o aplicativo Terminal e utilizar o comando "\textit{ssh usuario@computador}", conforme \autoref{fig:ex-terminal}. Esse tipo de abordagem é bastante utilizada para conexão a servidores na nuvem, para executar comandos, softwares, entre outros.

\begin{figure}[htb]
	\caption{\label{fig:ex-terminal}Conexão com o \textit{RPi} via \textit{SSH}.}
	\begin{center}
		\includegraphics[width=0.9\textwidth]{img/terminal-pi.png}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

% ---
\subsection{Smartphones e Tablets}\label{sec:smartphone-tablets}
% ---

Foi utilizado o smartphone Moto Maxx com sistema Android 5.0.1 e o tablet iPad mini Retina com sistema iOS 8.4 confirme \autoref{fig:motomaxx-ipad}. 

O aplicativo utilizado em ambos foi o \textit{Locate Beacon} da \textit{Radius Networks}, que nos permite identificar os \textit{beacons} e também simular um, para realizar os testes com diferentes tipos, podendo alterar os valores de UUID, Major, Minor e potência de transmissão. 

\begin{figure}[htb]
	\caption{\label{fig:motomaxx-ipad}Moto Maxx (esquerda) e iPad Mini (direita).}
	\begin{center}
		\includegraphics[width=0.7\textwidth]{img/motomaxx-ipad.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

% ---
\subsection{Beacons}\label{sec:beacons-modo}
% ---

O \textit{beacon} utilizado para testes foi o \textit{Zebra MPact}, conforme \autoref{fig:zebra-mpact}. Utiliza uma bateria CR2450 para alimentação de energia. 

\begin{figure}[htb]
	\caption{\label{fig:zebra-mpact}\textit{Beacon} Zebra MPact utilizado para testes.}
	\begin{center}
		\includegraphics[width=0.6\textwidth]{img/beacon-mpact2.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

A empresa \textit{Zebra} tem um sistema de administração e gerenciamento nomeado \textit{MPact Toolbox}, instalado em um servidor do LTIA com sistema Debian 8.1. Esse sistema foi utilizado neste projeto somente para conhecimento da tecnologia \textit{beacon} e atualização do \textit{firmware}, disponível somente via \textit{Toolbox}. Esse software também apresenta a porcentagem de bateria, conforme \autoref{fig:exemplo-toolbox}. 

Permite a configuração de vários \textit{beacons} simultaneamente, além de alterar o modo de funcionamento, de \textit{iBeacon} para \textit{MPact}, protocolo criado pela fabricante.

\begin{figure}[htb]
	\caption{\label{fig:exemplo-toolbox}\textit{Beacon} configurado na \textit{Toolbox} apresentando a porcentagem de bateria.}
	\begin{center}
		\includegraphics[width=0.7\textwidth]{img/toolbox-exemplo.png}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

% ---
\subsection{Acessórios para o Protótipo}\label{sec:acess-prototipo}
% ---

O protótipo foi adaptado em uma caixa de metal (\autoref{fig:caixa-metal}), furada conforme projeto e pintada de preto. Esse processo está detalhado na \autoref{sec:segunda-etapa}. 

\begin{figure}[htb]
	\caption{\label{fig:caixa-metal}Caixa de metal utilizada para o protótipo}
	\begin{center}
		\includegraphics[width=0.7\textwidth]{img/caixa-metal.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Para o protótipo final foram utilizados seis LEDs, resistores, barra de pinos, um display azul de 16 colunas por 2 linhas, três botões do tipo clique, cabos \textit{flat} do tipo IDE e \textit{floppy}, placas com furação para soldagem de componentes, cabos finos removidos de um cabo de rede \textit{ethernet} para ligações entre os componentes e cola quente para fixação dos componentes internos. Esses materiais podem ser vistos na \autoref{fig:prot-interno}.

\begin{figure}[htb]
	\label{teste}
	\centering
 	\begin{minipage}{0.43\textwidth}
		\centering
		\caption{\label{fig:prot-interno}Parte interna do protótipo}
		\includegraphics[width=0.7\textwidth]{img/prot-interno.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.55\textwidth}
		\centering
		\caption{\label{fig:proto-teste}Protoboard na etapa de estudo}
		\includegraphics[width=1\textwidth]{img/proto-teste.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

Durante a fase de estudo das tecnologias utilizou-se uma protoboard e fios de conexão (\autoref{fig:proto-teste}) para testes de código, modo de conexão, entre outros, detalhado na \autoref{sec:segunda-etapa}.

Como o \textit{RPi} tem limitações quanto a quantidade de pinos de entrada e saída digitais (explicados na \autoref{sec:rpi-tecnologia}), os componentes definidos para o protótipo foram determinados conforme possibilidade de conexões. Cada componente necessita de:

\begin{alineas}
	\item um pino de saída digital (GPIO) para acender ou apagar cada LED;
	\item um pino de entrada digital para leitura do estado de cada botão;
	\item seis pinos de saída no total, sendo quatro de dados, um \textit{enable} (ou ativar), e outro \textit{register select}, para o display LCD.
\end{alineas}

O uso desses componentes foram determinados na segunda etapa, detalhada na \autoref{sec:segunda-etapa} - \nameref{sec:segunda-etapa}.


% ----------------------------------------------------------
\section{Tecnologias e Ferramentas}\label{sec:tecnologias-ferramentas}
% ----------------------------------------------------------


% ---
\subsection{Raspberry Pi}\label{sec:rpi-tecnologia}
% ---

O \textit{RPi} é a tecnologia mais importante desse projeto. Já foi abordado na \autoref{sec:raspberry-pi} e \autoref{sec:rpi-acessorios}, porém nessa seção outros aspectos serão comentados.

A arquitetura da CPU do \textit{RPi 2 modelo B}, utilizado nesse projeto, é baseada na \textit{arm-v7}. Consequentemente todos os softwares devem ser compilados em \textit{arm} para que possam ser executados com sucesso. 

Alguns softwares foram abordados para utilização, porém não haviam versões \textit{arm} compatíveis ou estáveis para utilização. Entre eles, o banco de dados MongoDB foi descartado pela versão de instalação \textit{arm} não ter sido testada no \textit{RPi}, e gerada pela comunidade. Diversos relatos de \textit{bugs}, mal funcionamentos e incompatibilidade levaram a mudar a tecnologia de banco de dados.

Uma ferramenta muito importante disponível no \textit{Raspberry Pi} são as GPIOs, ou \textit{General Purpose Input/Output} - portas de entrada e saída de uso geral (\autoref{fig:gpio-pins-pi2}).  

\begin{citacao}
"Esses pinos são a interface física de conexão entre o Pi e o mundo. No mais baixo nível, você pode pensar delas como interruptores que você pode ligar ou desligar (entrada) ou que o Pi possa ligar ou desligar (saída). Dos 40 pinos, 26 são pinos de GPIO e os outros são pinos de energia ou terra.". \cite{rpi-gpio}
\end{citacao}

Seguem um padrão definido de numeração (\autoref{fig:gpio-numbers-pi2}). Esses números são utilizados diretamente na programação para acessar os pinos e interagir com o que estiver conectado ali.

\begin{figure}[htb]
	\caption{\label{fig:gpio-pins-pi2}Pinos físicos de conexão}
	\begin{center}
		\includegraphics[width=0.9\textwidth]{img/gpio-pins-pi2.jpg}
	\end{center}
	\legend{Fonte: \cite{rpi-gpio}}
\end{figure}

\begin{figure}[htb]
	\caption{\label{fig:gpio-numbers-pi2}Numeração dos pinos de conexão}
	\begin{center}
		\includegraphics[width=0.9\textwidth]{img/gpio-numbers-pi2.png}
	\end{center}
	\legend{Fonte: \cite{rpi-gpio}}
\end{figure}


% ---
\subsection{Node.js e npm}\label{sec:node-js}
% ---

Node.js\footnote{\url{https://nodejs.org/}} é uma plataforma de aplicações baseada no motor de Javascript do Google Chrome chamado V8. \cite{o-que-e-node}. A linguagem Javascript normalmente é utilizada no navegador, no chamado lado do cliente, porém o Node leva essa linguagem de programação diretamente para o sistema operacional, permitindo que aplicações sejam executadas direto no lado servidor. Seu código fonte está disponível\footnote{\url{https://github.com/nodejs/node}} para acesso, colaboração e comentários.

Utiliza um modelo de aplicações voltado a eventos, ou seja, não bloqueia a execução do código com entrada e saída, cálculos, etc. Em vez disso dispara as funções quando os eventos forem acionados. \cite{o-que-e-node}.

Essa plataforma possui um aplicativo chamado \textit{Node Package Manager} (denominado \textit{npm}). Esse aplicativo auxilia a instalação e distribuição de pacotes e bibliotecas auxiliares, normalmente criadas pela comunidade e de código livre. Qualquer pessoa pode criar sua biblioteca, enviar ao GitHub, e enviar ao \textit{npm}.

O \textit{npm} cria o arquivo \textit{packages.json} e salva todas as informações do projeto. Nome do projeto, do criador, link para o repositório no GitHub, dependências de bibliotecas com a versão específica instalada, entre outros. Facilita o trabalho de outra pessoa, pois quando pegar o código fonte, executando o comando \textit{npm install} já baixa e instala todas as dependências para executar aquele aplicativo.

Diversos pacotes foram utilizados no desenvolvimento desse projeto:

\begin{alineas}
	\item \textbf{\textit{bleacon}}: para descoberta e transmissão de pacotes \textit{beacon};
	\item \textbf{\textit{lcd}}: auxilia na conexão com displays de LCD;
	\item \textbf{\textit{nano}}: auxilia na conexão com o banco de dados CouchDB;
	\item \textbf{\textit{onoff}}: disponibiliza funções para conexões com LEDs, botões e hardwares no geral - específico para Raspberry Pi e BeagleBone\footnote{Computador do tamanho de um cartão de crédito, similar ao Raspberry Pi};
	\item \textbf{\textit{node-constants}}: facilita o uso de constantes entre arquivos e funções;
	\item \textbf{\textit{numeral}}: funções para manipulação avançada de números inteiros e floats;
	\item \textbf{\textit{is-online}}: função para validar conexão com a internet;
	\item \textbf{\textit{internal-ip}}: funcão para retornar o endereço de IP da rede interna;
	\item \textbf{\textit{public-ip}}: funcão para retornar o endereço de IP da rede externa, ou IP público;
\end{alineas}

Quando foi instalado no Raspbian Wheezy, a versão mais recente, compatível e recomendada para o \textit{RPi} era a v0.12.6. Atualmente já existem versões mais novas, porém essa versão permaneceu por questões de compatibilidade com o software desenvolvido.

Para que o sistema executasse constantemente e automaticamente toda vez que o \textit{RPi} fosse ligado, um software desenvolvido em Node.js foi utilizado, denominado pm2\footnote{\url{https://github.com/Unitech/pm2}}. Esse aplicativo permite iniciar um software desenvolvido em Node.js, fornece ferramentas para monitorar, reiniciar, parar, entre outros.

% ---
\subsection{CouchDB}\label{sec:couchdb}
% ---

CouchDB\footnote{\url{http://couchdb.org/}} é um sistema gerenciador de banco (SGBD) de dados voltado para a \textit{web} e \textit{apps mobile}. Não é um SGBD baseado em SQL, em vez disso utiliza documentos no formato \textit{JSON} (JavaScript Object Notation)\footnote{Modo de formatação dos dados. Muito leve, utilizada para troca de informações entre máquinas, por ser de fácil interpretação e geração. \cite{json-couch}.}, as conexões e requisições são feitas por HTTP (similar a uma conexão a um site), além de permitir servir páginas web direto do banco de dados.

Esse sistema foi escolhido para o projeto pela facilidade de uso com o Node.js. O pacote \textit{nano} para Node abstrai toda a conexão com o banco de dados, permitindo que pouco código seja utilizado. Os documentos gerados no formato JSON no Javascript são enviados diretamente ao CouchDB sem necessidade de tratamento, manipulação ou configuração.

Disponibiliza uma ferramenta web para acesso aos bancos de dados criados denominada \textit{Futon}, a partir da instalação já funciona normalmente acessando o endereço \textit{http://localhost:5984/\_utils/} (\autoref{fig:futon-overview}).

\begin{figure}[htb]
	\caption{\label{fig:futon-overview}Futon - manipulação dos bancos de dados CouchDB}
	\begin{center}
		\includegraphics[width=0.9\textwidth]{img/futon-overview.png}
	\end{center}
	\legend{Fonte: \cite{futon-couch}}
\end{figure}

% ---
\subsection{Git}\label{sec:git}
% ---

Git é um software de controle de versão para repositórios. Registra as mudanças nos arquivos (ou grupo de arquivos) ao longo do tempo, de forma que as versões possam ser recuperadas futuramente. \cite{pro-git}. Caso necessário voltar algumas versões por \textit{bug} no código, mal funcionamento de uma função recém implementada ou outras razões, as alterações estarão todas salvas.

Atualmente o Git é muito utilizado por projetos de código aberto, como por exemplo o Swift\footnote{\url{https://github.com/apple/swift}} que é uma linguagem de programação criada pela Apple voltada para seus sistemas operacionais, e o AngularJS\footnote{\url{https://github.com/angular/angular.js}}, framework Javascript mantido pelo Google.

É possível configurar o repositório local para sincronizar com um repositório remoto, por meio de \textit{push} (enviar mudanças) e \textit{pull} (buscar mudanças). Dessa forma promove a divisão do trabalho, removendo o problema de sincronização de código entre diferentes máquinas e pessoas.

% ---
\subsubsection{GitHub}\label{sec:github}
% ---



% ---
\subsection{Outras Ferramentas}\label{sec:outras-ferramentas}
% ---

Durante o desenvolvimento desse trabalho foi necessário a criação de uma proposta e um relatório parcial, ambos para a disciplina de Projeto e Implementação de Sistemas I. Para tal, o autor utilizou a ferramenta denominada LaTeX. Como não está entre os objetivos desse projeto, mas houve um grande crescimento no seu uso, está detalhada no \autoref{ap:latex}.


% ----------------------------------------------------------


% ----------------------------------------------------------
% Experimentos e Resultados
% ----------------------------------------------------------
\chapter{Desenvolvimento}\label{cap:desenvolvimento}
% ----------------------------------------------------------

% ----------------------------------------------------------
\section{Primeira Etapa - Estudo Prático das Tecnologias}\label{sec:primeira-etapa}
% ----------------------------------------------------------

O primeiro experimento realizado foi a tentativa de identificação de um \textit{beacon} com o \textit{RPi}, para o estudo de funcionamento e comportamento dessas tecnologias. Para isso, o ambiente foi configurado conforme \autoref{fig:inicio-ambiente}. 

\begin{figure}[htb]
	\caption{\label{fig:inicio-ambiente}Primeiro teste realizado, com \textit{RPi} e \textit{beacon MPact}}
	\begin{center}
		\includegraphics[width=0.66\textwidth]{img/ambiente1.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

O computador ficou conectado via SSH com o \textit{RPi}, recebendo as informações de leitura de pacotes \textit{BLE}. Os softwares utilizados para isso foram, conforme \citeonline{stack-overflow-ibeacon}, os seguintes:

\begin{alineas}
	\item \textbf{hcitool}: configurado da maneira \textit{hcitool lescan --duplicates}, faz um scan na frequência \textit{BLE} procurando por dispositivos que estejam transmitindo, conforme \autoref{fig:hcitool-lescan}.
	
	\begin{figure}[htb]
		\caption{\label{fig:hcitool-lescan}Software \textit{hcitool} executando}
		\begin{center}
			\includegraphics[width=0.6\textwidth]{img/hcitool-lescan.png}
		\end{center}
		\legend{Fonte: elaborado pelo autor}
	\end{figure}

	\item \textbf{hcidump}: em conjunto com o \textit{hcitool}, apresenta todos os pacotes escaneados na rede. Executado da maneira \textit{hcidump --raw}, conforme \autoref{fig:hcidump}.
	
	\begin{figure}[htb]
		\caption{\label{fig:hcidump}Software \textit{hcidump} executando}
		\begin{center}
			\includegraphics[width=0.6\textwidth]{img/hcidump.png}
		\end{center}
		\legend{Fonte: elaborado pelo autor}
	\end{figure}

\end{alineas}

Em seguida, com os softwares em execução e os pacotes sendo analisados, o \textit{beacon} foi movido ao longo mesa para ficar a diferentes distâncias do \textit{RPi}, conforme \autoref{fig:movimenta-beacon}. Esse passo foi necessário para verificar o formato dos pacotes recebidos e também analisar a distância máxima de identificação.

\begin{figure}[htb]
	\caption{\label{fig:movimenta-beacon}Teste com movimentação do \textit{beacon}}
	\begin{center}
		\includegraphics[width=0.7\textwidth]{img/ambiente4.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Com o adaptador Orico BTA-406 e posicionamento na mesa conforme \autoref{fig:inicio-ambiente} e \autoref{fig:movimenta-beacon}, a cerca de 1,3 a 1,4 metros de distância entre o \textit{RPi} e o \textit{beacon} os pacotes já começaram a falhar e a leitura não foram tão constante.

O posicionamento do \textit{RPi} foi alterado para testes, conforme \autoref{fig:posiciona-rpi}. Notou-se uma melhoria na recepção dos pacotes, a 1,5 metros entre o \textit{RPi} e o \textit{beacon} os pacotes começaram a falhar, com recebimento de informações notada até 1,6 metros.

\begin{figure}[htb]
	\caption{\label{fig:posiciona-rpi}\textit{RPi} posicionado de outra maneira}
	\begin{center}
		\includegraphics[width=0.8\textwidth]{img/ambiente2.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Durante essa etapa não foram levados em consideração conexões com LEDs, botões e display LCD para a montagem do protótipo pois esses componentes foram definidos posteriormente. Os estudos e testes desses materiais foram realizados na segunda etapa, para que as escolhas fossem validadas.

% ----------------------------------------------------------
\section{Segunda Etapa - Planejamento do Protótipo}\label{sec:segunda-etapa}
% ----------------------------------------------------------

Para que o protótipo pudesse ser bem planejado, parâmetros foram definidos:

\begin{alineas}
	\item ter uma interface amigável e simples para interação com o software;
	\item ser bem apresentável, com cores marcantes e boa construção;
	\item mostrar informações relevantes sobre o sistema - aplicação, software e sistema (Linux e \textit{RPi});
	\item ser construído em um único pacote, não muito grande nem muito pequeno;
\end{alineas}

Seguindo esses parâmetros, a primeira busca foi por um recipiente para alocar todos os componentes necessários, de forma que tudo ficasse bem protegido. Para tal, escolheu-se uma caixa de metal, derivada de uma antiga caixa de cigarros, apresentado na \autoref{sec:acess-prototipo}.

O material foi cortado primeiramente na parte de baixo de forma que acomodasse o \textit{RPi} deixando todas as conexões disponíveis para futuro desenvolvimento e facilidade de acessar as portas. Foram realizados furos na parte do fundo para fixação do \textit{RPi} com parafusos, arruelas e porcas, conforme \autoref{fig:rpi-caixa}.

% TODO - FOTO DO FUNDO COM OS PARAFUSOS

\begin{figure}[htb]
	\caption{\label{fig:rpi-caixa}\textit{RPi} preso na caixa, com as portas acessíveis}
	\begin{center}
		\includegraphics[width=0.6\textwidth]{img/rpi-caixa.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Dessa maneira o RPi ficou bem preso na parte de baixo, liberando a tampa para instalação da interface com o usuário.

O próximo passo foi para definir a interface com o usuário. Para que os parâmetros fossem cumpridos, os seguintes itens necessários foram elencados:

\begin{alineas}
	\item apresentar informação em que consistia se o sistema está executando a aplicação corretamente - para tal definiu-se o uso de um LED verde;
	\item apresentar informação em que consistia se o sistema tem conexão com a internet - para tal definiu-se o uso de um LED amarelo;
	\item apresentar informação em que consistia se um beacon está no alcance - para tal definiu-se o uso de um LED azul;
	\item apresentar várias informações textuais sobre o estado atual do sistema, assim como beacons no alcance, histórico, dados do Linux, endereço de IP, temperatura da CPU - para tal, definiu-se o uso de um display LCD de 16 colunas por 2 linhas.
\end{alineas}

Como o display era pequeno e não apresentou todas as informações de uma só vez, decidiu-se pela utilização de navegação por páginas, de forma que as informações fossem alteradas conforme avançasse nas páginas. Para que a navegação fosse realizada de maneira agradável e apresentável, os seguintes itens foram escolhidos:

\begin{alineas}
	\item LEDs indicando qual página está - definiu-se pelo uso de três LEDs verde;
	\item botões do tipo clique para navegar a direita e esquerda nas páginas principais, e entre as páginas secundárias.
\end{alineas}

Com os componentes bem definidos, a interface foi concebida inicialmente em rascunhos no papel. Foi necessário realizar testes com os LEDs, display LCD e botões na protoboard de forma que todos esses componentes pudessem ser conectados ao mesmo tempo (\autoref{fig:proto-lcd} e \autoref{fig:proto-leds}). 

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.47\textwidth}
		\centering
		\caption{\label{fig:proto-lcd}Estudo de conexão e programação com display LCD}
		\includegraphics[width=1\textwidth]{img/proto-lcd.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.47\textwidth}
		\centering
		\caption{\label{fig:proto-leds}Conexão com LEDs, display e botão na protoboard}
		\includegraphics[width=1\textwidth]{img/proto-leds.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

Nesse momento definiu-se o uso de Node.js (detalhado na \autoref{sec:node-js}) para o desenvolvimento, pois foram encontrados diversos tutoriais\footnote{\url{http://thejackalofjavascript.com/rpi-16x2-lcd-print-stuff/}}\footnote{\url{http://odesenvolvedor.andafter.org/publicacoes/controlando-gpio-do-raspberrypi-com-nodejs.html}}\footnote{\url{https://learn.adafruit.com/node-embedded-development/why-node-dot-js}} e bibliotecas\footnote{\url{https://www.npmjs.com/package/lcd}}\footnote{\url{https://www.npmjs.com/package/onoff}} que facilitaram a conexão com todos os componentes.

Após realizar todos os estudos e testes de conexão com sucesso, o próximo passo foi a montagem da interface na caixa de metal. Primeiro os cortes foram feitos com uma ferramenta específica tipo esmeril, em seguida a caixa foi pintada com tinta preta fosca (\autoref{fig:pintar-1} e \autoref{fig:pintar-2}) para que o protótipo ficasse com boa construção e visualização.

Foram necessários soldas e montagem dos outros componentes em placas para que tudo ficasse organizado e fácil de ser trocado, caso necessário. As conexões das GPIOs com os componentes de hardware estão marcados na \autoref{fig:pinout-gpio}.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:pintar-1}Pintura da caixa de metal - tampa}
		\includegraphics[width=1\textwidth]{img/pintar-1.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:pintar-2}Pintura da caixa de metal - base}
		\includegraphics[width=1\textwidth]{img/pintar-2.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

Cada LED foi conectado a uma GPIO, a um resistor de 330$\Omega$, e ao GND. Os botões foram conectados seguindo o modelo da \autoref{fig:push-btn-sketch}. O display foi conectado diretamente a cada GPIO marcada, e também ao +5V e GND para alimentação. 

O modelo de display LCD utilizado também tem um pino que utiliza voltagem variável para iluminar cada caractere (contraste de cada letra), e um pino para a iluminação do fundo (azul). Para essas conexões foram utilizados potenciômetros de 10K, para facilitar mudanças caso necessário (\autoref{fig:potentiometer}). Dessa forma, só é necessário girar o pino do potenciômetro para alterar a saída.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:push-btn-sketch}Modelo de conexão dos botões}
		\includegraphics[width=1\textwidth]{img/push-btn-sketch.png}
		\legend{Fonte: \cite{push-button}}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:potentiometer}Potenciômetros de configuração do display LCD}
		\includegraphics[width=1\textwidth]{img/potentiometer.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

\begin{figure}[htb]
	\caption{\label{fig:pinout-gpio}Circuito de conexão das GPIOs}
	\begin{center}
		\includegraphics[width=0.8\textwidth]{img/pinout-gpio.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

Foram utilizados seis GPIOs para os LEDs, três para os botões e seis para o display, totalizando 15 GPIOs de 17 disponíveis. As GPIOs utilizadas foram:

\begin{alineas}
	\item Para os LEDs de interface (topo), GPIO 12, 6 e 5, respectivamente 1, 2 e 3;
	\item Para os LEDs de informação (baixo), GPIO 22, 27 e 17, respectivamente Power, Internet e Beacon;
	\item Para os botões, GPIOs 24, 23 e 18, respectivamente botão esquerdo, central e direito;
	\item Para o display de LCD, GPIOs 16, 20, 13, 19, 26, 21, respectivamente Register Select, Enable, Data 1, Data 2, Data 3 e Data 4.
	\nota{Os números das GPIOs foram escolhidos devido a proximidade e agrupamento dos componentes.}
\end{alineas}

De forma que a tampa saísse facilmente optou-se por usar um cabo flat frequentemente usado em HDs antigos (padrão IDE) conectado ao \textit{RPi} e a uma placa central com duas fileiras de 20 pinos.

Utilizando os fios internos de cabo de rede para conexão entre os componentes nas placas, o mesmo cabo flat cortado para conexão entre as placas para uma maior flexibilidade e facilidade de mudanças, criou-se o controle da interface, como pode ser visto na \autoref{fig:interface-traz1} e \autoref{fig:interface-traz2}.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:interface-traz1}Parte interna da interface - parcialmente desmontada}
		\includegraphics[width=1\textwidth]{img/interface-traz1.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:interface-traz2}Parte interna da interface - completamente montada}
		\includegraphics[width=1\textwidth]{img/interface-traz2.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

As placas internas da interface foram afixadas com cola quente, para que os cabos fossem reforçados e nenhuma conexão fosse quebrada. Tampa e base foram conectados com o cabo flat (\autoref{fig:tampa-base}) e o protótipo ficou pronto para desenvolvimento da aplicação.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:tampa-base}Conexão da tampa com a base}
		\includegraphics[width=0.84\textwidth]{img/tampa-base.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:prot-final}Criação e montagem do protótipo finalizada}
		\includegraphics[width=1\textwidth]{img/prot-final-2.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

Após o hardware estar totalmente montado, as informações apresentadas nas telas foram elaboradas:

\begin{alineas}
	\item A primeira tela mostra informações sobre os beacons no alcance, ou caso não haja nenhum, apresenta o texto "\textit{Aguardando beacons}". As subtelas apresentam informações sobre quais beacons estão no alcance, sendo o nome atribuidos a eles ou então o texto "\textit{Desconhecido}"\ caso não esteja no banco de dados. A quantidade de subtelas depende da quantidade de beacons no alcance, por isso não se sabe ao certo a quantidade total;
	\item A segunda tela apresenta um histórico dos beacons encontrados durante a execução do programa, com um contador da quantidade de beacons no histórico, e as subtelas apresentam o nome do beacon encontrado em ordem numérica. Se um beacon for encontrado diversas vezes, será repetido nas subtelas. Conforme a primeira tela, a quantidade de subtelas depende da quantidade de beacons no histórico, por isso não se sabe ao certo a quantidade total;
	\item A terceira tela apresenta informações relevantes sobre o sistema, sendo elas:
	\begin{subalineas}
		\item Primeira subtela apresenta o \textit{load average}\footnote{Segundo \citeonline{load-average}, essa informação de três números apresenta a média de carga da CPU por um certo tempo. O primeiro número é a média no último minuto, o segundo número é a média nos últimos cinco minutos, e o terceiro número é a média nos últimos quinze minutos} do sistema Linux. É relevante para saber se o sistema está muito carregado ou trabalhando tranquilamente;
		\item Segunda subtela apresenta a temperatura do processador. É relevante para saber se o sistema está trabalhando a uma temperatura segura ou está sobreaquecendo;
		\item Terceira subtela apresenta o endereço de IP privado da rede. É de extrema importância para conexão remota, pois é esse endereço que é utilizado para conexão via \textit{SSH};
		\item Quarta subtela apresenta o endereço de IP público da rede. É relevante para saber se está conectado direto a internet (o IP privado será igual ao IP público) ou em uma subrede, como de uma residência ou do laboratório.
	\end{subalineas}
\end{alineas}

Após todos esses passos o protótipo estava bem definido para o desenvolvimento.

% ---
\subsection{Logotipo e Nome para o Protótipo}\label{sec:logotipo-prototipo}
% ---

Por ser um produto, decidiu-se que o protótipo deveria ter um nome e logotipo. Durante algumas reuniões de \textit{brainstorm}, o nome \textit{Peacon} surgiu e foi o escolhido. Esse nome deriva das palavras \textit{Pi}  + \textit{beacon}.

Juntando todos os atributos do Peacon, criou-se um logotipo que identificasse muito bem todas as funcionalidades do protótipo (\autoref{fig:logo-peacon}). Adesivos foram criados para colar no protótipo e identificar o produto. Também foi criado um logotipo menor, para colar em componentes secundários (\autoref{fig:logo-menor-peacon}).


\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:logo-peacon}Logotipo criado para o protótipo}
		\includegraphics[width=1\textwidth]{img/logo-peacon.png}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:logo-menor-peacon}Logotipo menor criado para o protótipo}
		\includegraphics[width=1\textwidth]{img/logo-menor-peacon.png}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}


% ---
\subsection{Problemas Enfrentados}\label{sec:problemas-enfrentados}
% ---

Durante os estudos e testes dos LEDs na protoboard utilizou-se resistores de 330$\Omega$ para conexão correta. Quanto maior o valor da resistência, menor brilho o LED apresenta. Como os componentes estavam na protoboard, não percebeu-se que os LEDs utilizados eram de alto brilho.

Para soldagem final dos componentes, preferiu-se por manter os resistores de 330$\Omega$ por questões práticas. Porém os LEDs ficaram com muito brilho, incomodando qualquer pessoa que olhasse diretamente para o protótipo, conforme \autoref{fig:led-forte-1} e \autoref{fig:led-forte-2}.

Como os componentes já estavam afixados com cola quente, substituir os resistores levaria muito tempo e possivelmente atrasaria o desenvolvimento do projeto, portanto optou-se por manter dessa maneira. Para um futuro protótipo, resistores maiores, ou LEDs com menos brilho podem ser utilizados.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:led-forte-1}LED de alto brilho ao olhar diretamente}
		\includegraphics[width=1\textwidth]{img/led-forte-1.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:led-forte-2}LEDs de alto brilho refletindo na mesa}
		\includegraphics[width=1\textwidth]{img/led-forte-2.jpg}
		\legend{Fonte: elaborado pelo autor}
	\end{minipage}
\end{figure}

% ----------------------------------------------------------
\section{Terceira Etapa - Desenvolvimento e Testes da Aplicação}\label{sec:terceira-etapa}
% ----------------------------------------------------------

A aplicação foi dividida em módulos por maior facilidade de desenvolvimento, testes e descoberta de erros. Um arquivo de configurações globais, nomeado \textit{globals-config.js}, foi utilizado para todas as definições de constantes de forma a facilitar futuras mudanças, caso necessário. 

% ---
\subsection{Primeiro Módulo - Biblioteca Auxiliar}\label{sec:primeiro-modulo}
% ---

O primeiro módulo desenvolvido foi a interface, que consiste da conexão com LEDs, botões e display LCD. Optou-se por criar uma biblioteca auxiliar para abstrair métodos repetitivos e também irrelevantes para os outros módulos. Como esse módulo é o meio de acesso do código principal aos componentes de hardware, foram adicionados trechos de teste para acender o LED e apagar o LED pela linha de comando, de forma que os testes de funcionalidade pudessem ser realizados.

Durante a fase de testes do primeiro módulo, um fato interessante ocorreu. Ao clicar uma única vez em um botão, em algumas vezes o código executava dois, três ou até mais cliques de botão. Pesquisando mais a fundo sobre esse erro, uma informação nova surgiu. 

Botões mecânicos não criam ou perdem o contato corretamente, conforme caso ideal e perfeito representado no gráfico apresentado na \autoref{fig:debounce-graph-1}. Em vez disso, podem oscilar rapidamente no momento do clique ou ao soltar o botão, conforme gráfico apresentado na \autoref{fig:debounce-graph-2}. \cite{debounce-graph}. Esse efeito é conhecido como \textit{bounce}, ou ruído.

\begin{figure}[htb]
	\centering
 	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:debounce-graph-1}Gráfico ideal de um clique de botão}
		\includegraphics[width=0.8\textwidth]{img/debounce-graph-1.jpg}
		\legend{Fonte: \cite{debounce-graph}}
	\end{minipage}
	\hfill
	\begin{minipage}{0.45\textwidth}
		\centering
		\caption{\label{fig:debounce-graph-2}Gráfico real de um clique de botão}
		\includegraphics[width=0.8\textwidth]{img/debounce-graph-2.jpg}
		\legend{Fonte: \cite{debounce-graph}}
	\end{minipage}
\end{figure}

A solução para resolver esse problema (denominada \textit{debounce}) foi de bloquear todos os cliques após o primeiro clique via programação por determinado tempo (em milissegundos), de forma que não interferisse diretamente nos cliques reais do usuário. Esse tempo foi determinado por testes repetitivos e por diferentes usuários em 200ms. Esse valor foi considerado ideal por evitar o ruído e não interferir em cliques seguidos do usuário. Valores maiores, como 300ms afetaram o clique do usuário, e valores inferiores como 100ms não evitaram totalmente o ruído.

% ---
\subsection{Segundo Módulo - Páginas e Navegação}\label{sec:segundo-modulo}
% ---

O segundo módulo consistiu da criação e navegação entre páginas. Para que as páginas secundárias pudessem ser dinamicamente inseridas nas telas, utilizou-se uma matriz de funções para lidar com a troca de informações na interface. 

Esse método foi muito eficaz e encaixou muito bem na metodologia de desenvolvimento para Node.js. No momento em que se avança na tela, a função na próxima posição do vetor é executada. Isso permitiu que cada tela, com as suas particularidades, fossem de fácil criação e alteração.

Não houveram problemas, erros ou \textit{bugs} nesse módulo, pela sua simplicidade. No desenvolvimento dos métodos futuros, trechos de métodos criados nesse passo sofreram pequenas alterações de adaptação.

% ---
\subsection{Terceiro Módulo - Identificação dos Beacons}\label{sec:terceiro-modulo}
% ---

Nesse módulo foram implementadas as funções de identificação dos \textit{beacons}. Quando um \textit{beacon} entra no alcance, é salvo em um vetor auxiliar. 

Como os \textit{beacons} transmitem pacotes de tempos em tempos, houve necessidade de criar uma lógica para verificar se ainda estavam no alcance depois de determinado tempo. Para isso, no momento em que um pacote \textit{beacon} é identificado, dispara um evento a ser executado após um determinado tempo (em segundos). O valor do tempo de espera foi descoberto por meio de seguidos testes, e o valor ideal encontrado é de 3 segundos.

Com a implementação de os beacons entrando e saindo do alcance pronta, o próximo passo foi apresentar nas páginas principais e secundárias a quantidade de beacons atualmente descobertos, e implementar o histórico da aplicação. Nesse módulo os \textit{beacons} ainda não são salvos, permanecendo somente durante a execução do programa.

% ---
\subsubsection{Problemas Descobertos}\label{sec:problema-quarto-modulo}
% ---

O módulo de identificação dos beacons apresentou um problema constante em todas as primeiras execuções após reinicialização do \textit{RPi}. O módulo bluetooth não reportava nenhum pacote beacon, e nenhuma descoberta era possível. 

Ao analisar a fundo esse problema, percebeu-se que o \textit{driver} desse módulo estava defeituoso, e nada poderia ser feito. A solução paliativa encontrada foi de reiniciar a interface bluetooth toda vez que o software fosse executado. Com essa solução, os pacotes beacon começaram a aparecer e funcionar normalmente.

Após algumas semanas, ao avançar no desenvolvimento e testes, percebeu-se que o problema se agravou. Em alguns momentos aleatórios durante a execução do programa o módulo parava de funcionar totalmente, sendo necessária a reinicialização da interface.

Essa solução, totalmente paliativa resolvia o problema momentaneamente. Não foram encontrados outros drivers ou solução para o problema, porém como não afetou o desenvolvimento e testes não foi necessário a troca do módulo \textit{bluetooth}.

% ---
\subsection{Quarto Módulo - Busca no Banco de Dados}\label{sec:quarto-modulo}
% ---

Até o momento o software somente apresentava a quantidade de \textit{beacons} no alcance, e não identificava os mesmos. Nesse módulo foi implementado a busca no banco de dados pelas informações do \textit{beacon} para possível identificação.

O CouchDB tem uma busca muito fácil e prática por identificadores de documento. De forma a aproveitar dessa funcionalidade, um padrão de identificadores e documentos foi criado:

\begin{verbatim}
Documento JSON para beacons conhecidos
[{
    "_id": "UUID-Major-Minor",
    "uuid": "numero-uuid",
    "major": "numero-major",
    "minor": "numero-minor",
    "name": "nome-beacon"
}]
\end{verbatim}

O campo \textit{\_id} é formado do número UUID, seguido pelo número \textit{Major}, e finalizado pelo número \textit{Minor}, todos separados pelo caractere - (menos). Exemplo de documento:

\begin{verbatim}
Exemplo de documento JSON para beacons conhecidos
[{
    "_id": "D9B9EC1F392543D080A91E39D4CEA95C-Major-Minor",
    "uuid": "D9B9EC1F392543D080A91E39D4CEA95C",
    "major": "2",
    "minor": "3",
    "name": "Beacon de LTIA"
}]
\end{verbatim}

Dessa forma o terceiro módulo foi aprimorado para apresentar o nome dos \textit{beacons}, permitindo a identificação dos mesmos. Se um \textit{beacon} não fosse encontrado no banco de dados, o texto "\textit{Desconhecido}" seria apresentado.

% ---
\subsection{Quinto Módulo - Salvar no Banco de Dados}\label{sec:quinto-modulo}
% ---

Para o quinto módulo, último a ser desenvolvido, restou a parte de salvar os \textit{beacons} encontrados. As informações relevantes a serem salvas foram: uuid, \textit{major}, \textit{minor}, data inicial (momento inicial que o beacon foi encontrado), tempo total no alcance (em segundos). 

\begin{verbatim}
Documento JSON para salvar beacons encontrados
[{
    "uuid": "numero-uuid",
    "major": "numero-major",
    "minor": "numero-minor",
    "initialDate": "data-inicial-em-timestamp",
    "totalTime": "tempo-total-em-segundos",
}]
\end{verbatim}

Como o valor de \textit{\_id} não necessita de uma formatação, optou-se por utilizar o CouchDB para gerar um UUID aleatório e atribuir ao \textit{\_id}. Não se deve confundir o UUID gerado pelo CouchDB pelo UUID do \textit{beacon}.

% ---
\subsection{Testes e Resultados}\label{sec:testes-resultados}
% ---

Após o desenvolvimento de todos os módulos, a aplicação estava pronta para testes. Como os testes de erros e \textit{bugs} foram realizados após cada módulo, com sucesso, nessa parte somente foi testado a capacidade e geração dos dados.

O software pm2 foi configurado para executar o aplicativo, monitorasse erros, fechamentos inexperados, entre outros, e os testes puderam iniciar:

\begin{alineas}
	\item \textbf{Primeiro teste}: descoberta de cada \textit{beacon} MPact individualmente, a diferentes distâncias;
	\item \textbf{Segundo teste}: descoberta de mais de um \textit{beacon} MPact simultaneamente, alternando um, dois e três a diferentes distâncias;
	\item \textbf{Terceiro teste}: \textit{beacons} MPact em movimento, a diferentes distâncias;
	\item \textbf{Quarto teste}: mistura de \textit{beacons} MPact com iPad e Moto Maxx, diferentes quantidades e distâncias;
	\item \textbf{Quinto teste}: diferentes localizações dos \textit{beacons} MPact, no bolso da calça com o usuário parado e em movimento.
\end{alineas}

Todos os testes foram repetidos durante diferentes momentos do dia, durante duas semanas. Os resultados foram:

\begin{alineas}
	\item misturar os dispositivos (\textit{beacon MPact} e smartphones/tablets) não afetou em nenhum ponto - a recepção de todos continuava normalmente, sem interferências;
	\item o protótipo suportou quatro \textit{beacons} no alcance simultaneamente, sendo três MPact e o Moto Maxx transmitindo pacotes;
	\item \textit{beacons} em movimento apresentaram pouca ou nenhuma recepção - quando parados, recepção constante e mais afastada;
	\item quando no bolso da calça, o alcance ficou extremamente limitado - inclusive parado, a distância até o protótipo era muito pouca, no máximo 30cm.
\end{alineas}

% ---
\subsection{Protótipo Final}\label{sec:prototipo-final}
% ---

O protótipo foi desenvolvido com sucesso (\autoref{fig:prod-final}), todos os parâmetros foram satisfeitos e os testes e resultados apresentaram uma boa implementação do código. Melhorias para futuros protótipos podem ser elencadas:

\begin{alineas}
	\item Baterias internas para facilitar a execução em ambientes sem tomada próxima;
	\item Utilizar LEDs mais fracos ou resistores mais fortes;
	\item Utilizar um melhor adaptador \textit{bluetooth}, de preferência com antenas removíveis para adaptação das antenas dentro do protótipo;
	\item Colocar o \textit{RPi} totalmente dentro da caixa, deixando somente as portas necessárias.
\end{alineas}

Interessante notar que todas essas melhorias não são cruciais, mas para uma evolução e maior praticidade do produto final.

\begin{figure}[htb]
	\caption{\label{fig:prod-final}Protótipo finalizado e totalmente funcional}
	\begin{center}
		\includegraphics[width=0.65\textwidth]{img/prod-final.jpg}
	\end{center}
	\legend{Fonte: elaborado pelo autor}
\end{figure}

% ----------------------------------------------------------


% ----------------------------------------------------------
% Conclusão
% ----------------------------------------------------------
\chapter{Conclusão}
% ----------------------------------------------------------

FALTA ACERTAR!!!! Esse projeto tem como objetivo o aprofundamento na área de Internet das Coisas, pelo estudo das tecnologias de \textit{Bluetooth Low Energy}, \textit{Raspberry Pi} e \textit{beacons}. O resultado final será um protótipo de rastreador de \textit{beacons} utilizando o \textit{Raspberry Pi}, ainda em desenvolvimento.

A fundamentação teórica realizada por meio de pesquisa bibliográfica no início do projeto foi essencial para entender como os protocolos \textit{beacons} foram propostas e implementadas, como é o comportamento do \textit{Raspberry Pi}, entre outros. Em conjunto, o estudo das tecnologias foi de extrema importância para entender o funcionamento e utilização do \textit{RPi} e \textit{beacon}.

Certas atividades de extrema importancia ainda serão realizadas, mas o projeto ainda tem muitos frutos para render, caminhando em uma boa direção. A área de Internet das Coisas é uma área extremamente promissora, com áreas de pesquisa e implementação bem vastas. 

% ----------------------------------------------------------

% ----------------------------------------------------------------------------------------------------------------------------------



% ----------------------------------------------------------
% ELEMENTOS PÓS-TEXTUAIS
% ----------------------------------------------------------

% ----------------------------------------------------------
% Referências bibliográficas
% ----------------------------------------------------------
\bibliography{referencias}
% ----------------------------------------------------------

% ----------------------------------------------------------
% Apêndices
% ----------------------------------------------------------

% ---
% Inicia os apêndices
% ---
\begin{apendicesenv}

\include{latex}

\end{apendicesenv}
% ---

% ----------------------------------------------------------


\end{document}